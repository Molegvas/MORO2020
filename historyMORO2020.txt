.LOG

19:24 20.11.2019
Плата MORO2020v22 с исправлениями:
в цепь VDDUSB врезан диод
R86 2,7кОм вместо 5в на вход 1117 подается 6 вольт

Модуль ESP32 прошит DOWNLOADERом и запаян, 
под модулем термопрокладка для облегчения последующей отпайки.
OLED 1.3" - заменен разъем на угловой

Включение - подача питания 17 вольт через выводы на клеммы.
WiFi 192.168.244.1	- ок
WiFi 192.168.0.5	- ок
Вывод на индикатор	- ок
RGB светодиод		- ок
датчик температуры	- ок
опрос кнопок		- ок
кнопка сброса		- ок?

10:05 21.11.2019
питание через USB	- ок
USB терминал		- ок 

16:28 21.11.2019
Внешнее питание 17.6в заведено на /7, /8 TV2
LED2(R)			- ок
LED3(G) проверено, нет	- ок
Вентилятор 470uF/25v	- ок 20кГц, 16в мах? При перегреве показывает -273 - исправить?
Пульсации на измерениях - земля?

14:41 09.12.2019
Распайка ACS712 сменилась, ток инвертируется:
void MBoard::calcCurrent( int ivalue ) {
#ifndef V22    
    current = ( readVoltage( ivalue ) * acs712Multiplier + acs712Offset ) * currentMultiplier + currentOffset;
#else
    current = -( readVoltage( ivalue ) * acs712Multiplier + acs712Offset ) * currentMultiplier + currentOffset;
#endif
}

Параметры фильтрации ШИМ и номиналы компаратора напряжения (проверялось при 9.8в ШИМ 50%):
20кГц, 3.3мкФ, 5.6кОм (пост вр 0.02с)
Пульсации на нагрузку 20кОм 70мВ (2.1%)
ОУ+ 10.0/10.0кОм
ОУ- 13.0/910.0 (12.0/820.0) 

По токовому компаратору печально: уровни слишком малы.




 вляпать "+2" и "+1"...

В общем, если кому надо: (файл "TFT_ILI9163C.cpp" из пакета "TFT_ILI9163C_master.zip"

1018: void TFT_ILI9163C::setAddr(uint16_t x0, uint16_t y0, uint16_t x1, uint16_t y1){ 
1019:   #if defined(__MK20DX128__) || defined(__MK20DX256__) 
1020:       SPI.beginTransaction(ILI9163C_SPI); 
1021:       _setAddrWindow(x0,y0,x1,y1); 
1022:   #else 
1023:       setAddrWindow(x0+2,y0+1,x1+2,y1+1); //ВОТ ПРАВКА +2 и +1 
1024:   #endif 

Вроде заработало как надо, пиксели на месте))

10:33 21.12.2019
Инициализация состояний из .h перенесена в .cpp - в cccvfsm, не закончено
Выводы дисплея назначаются в moled.h (раньше в mboard.h)
DATA:    [=         ]  13.7% (used 44920 bytes from 327680 bytes)
PROGRAM: [========  ]  78.6% (used 1029998 bytes from 1310720 bytes)

Adafruit_ST77xx.cpp - добавлены +2 и +4 для смещения
void Adafruit_ST77xx::setAddrWindow(uint16_t x, uint16_t y, uint16_t w,
  uint16_t h) {
  x += _xstart + 2;                 - ОК
  y += _ystart + 4;                 - ОК
  uint32_t xa = ((uint32_t)x << 16) | (x+w-1);
  uint32_t ya = ((uint32_t)y << 16) | (y+h-1); 

Для поворота на 180 добавлено в setup() :
    tft.setRotation(2);             - ОК

12:00 22.12.2019
Новые кнопки, в режимах - через case

07:27 27.12.2019
Новый проект под GitHub
Открыт в E:\GitHub\MORO2020

20:28 12.01.2020
Корректировка про V43
Отключение RGB светодиода     - ОК
Сетевой фильтр                - ОК
6в, 3,3в                      - ОК
OLED (софт)                   - ОК
USB                           - ОК
Измерение температуры         - ОК
Вентилятор                    - ОК
Кнопки - есть, но не проверено
Напряжение - всегда 0
Ток - нет датчика
